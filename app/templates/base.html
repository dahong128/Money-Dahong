<!doctype html>
<html lang="en" class="h-full bg-surface text-gray-100 antialiased selection:bg-accent selection:text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Money-Dahong - {% block title %}{% endblock %}</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['JetBrains Mono', 'Menlo', 'monospace'],
          },
          colors: {
            surface: '#09090b', // Zinc 950
            panel: '#18181b',   // Zinc 900
            accent: '#10b981',  // Emerald 500
            'accent-hover': '#059669',
            danger: '#ef4444',
            'danger-hover': '#dc2626',
            border: '#27272a',  // Zinc 800
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-out',
            'slide-up': 'slideUp 0.4s ease-out',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
          }
        },
      },
    }
  </script>
  <style>
    /* Subtle grid background */
    body {
      background-color: #09090b;
      background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
      background-size: 32px 32px;
    }
    [v-cloak] { display: none; }
  </style>
</head>
<body class="h-full flex flex-col">
  <div id="app" class="flex flex-col min-h-full" v-cloak>
    <header class="border-b border-border bg-surface/80 backdrop-blur-md sticky top-0 z-50">
      <div class="mx-auto flex max-w-7xl items-center justify-between px-6 py-4">
        <div class="flex items-center gap-12">
            <a href="/" class="flex items-center gap-2 group">
                <div class="h-8 w-8 rounded-lg bg-gradient-to-br from-accent to-emerald-700 flex items-center justify-center text-white font-bold shadow-lg shadow-emerald-900/20 group-hover:shadow-emerald-900/40 transition-all duration-300">
                    MD
                </div>
                <div class="text-xl font-bold tracking-tight text-white group-hover:text-accent transition-colors">Money-Dahong</div>
            </a>
            <nav class="hidden md:flex items-center gap-1">
                <a href="/" class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 {% if request.path == '/' %}bg-accent/10 text-accent{% else %}text-gray-400 hover:text-gray-100 hover:bg-white/5{% endif %}" v-text="t('nav.dashboard')"></a>
                <a href="/trading" class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 {% if request.path == '/trading' %}bg-accent/10 text-accent{% else %}text-gray-400 hover:text-gray-100 hover:bg-white/5{% endif %}" v-text="t('nav.trading')"></a>
                <a href="/settings" class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 {% if request.path == '/settings' %}bg-accent/10 text-accent{% else %}text-gray-400 hover:text-gray-100 hover:bg-white/5{% endif %}" v-text="t('nav.settings')"></a>
            </nav>
        </div>
        <div class="flex items-center gap-4 text-sm">
          <div class="flex items-center p-1 rounded-lg bg-panel border border-border">
            <button 
              @click="setLanguage('zh-CN')"
              :class="['px-3 py-1 rounded-md text-xs font-medium transition-all duration-200', lang === 'zh-CN' ? 'bg-surface text-accent shadow-sm' : 'text-gray-400 hover:text-gray-100']"
              v-text="t('language.zh')">
            </button>
            <button 
              @click="setLanguage('en')"
              :class="['px-3 py-1 rounded-md text-xs font-medium transition-all duration-200', lang === 'en' ? 'bg-surface text-accent shadow-sm' : 'text-gray-400 hover:text-gray-100']"
              v-text="t('language.en')">
            </button>
          </div>
          <div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-panel border border-border">
            <div :class="['w-2 h-2 rounded-full animate-pulse', status === 'Active' ? 'bg-accent shadow-[0_0_8px_rgba(16,185,129,0.5)]' : 'bg-danger shadow-[0_0_8px_rgba(239,68,68,0.5)]']"></div>
            <span :class="['font-medium', status === 'Active' ? 'text-accent' : 'text-danger']" v-text="status === 'Active' ? t('status.systemActive') : t('status.systemStopped')"></span>
          </div>
        </div>
      </div>
    </header>

    <main class="flex-1 w-full mx-auto max-w-7xl px-6 py-8 animate-fade-in">
        {% block content %}{% endblock %}
    </main>
    
    <footer class="border-t border-border mt-auto bg-panel/50 backdrop-blur-sm">
        <div class="mx-auto max-w-7xl px-6 py-6 flex justify-between items-center text-xs text-gray-500">
            <p>&copy; 2026 <span v-text="t('footer.copyright')"></span></p>
            <div class="flex gap-4">
                <span v-text="t('footer.version')"></span>
                <span class="w-px h-4 bg-border"></span>
                <span><span v-text="t('footer.latency')"></span>: <span class="text-gray-400">14ms</span></span>
            </div>
        </div>
    </footer>
  </div>

  <script>
    const { createApp } = Vue

    const appName = 'Money-Dahong'
    const getInitialLang = () => {
        try {
            const saved = localStorage.getItem('lang')
            if (saved) return saved
        } catch (err) {
            console.error(err)
        }
        const browserLang = navigator.language || 'en'
        return browserLang.toLowerCase().startsWith('zh') ? 'zh-CN' : 'en'
    }

    const translations = {
        'en': {
            'app.name': 'Money-Dahong',
            'nav.dashboard': 'Dashboard',
            'nav.trading': 'Trading',
            'nav.settings': 'Settings',
            'language.zh': '中文',
            'language.en': 'EN',
            'status.systemActive': 'System Active',
            'status.systemStopped': 'System Stopped',
            'status.running': 'RUNNING',
            'status.stopped': 'STOPPED',
            'status.active': 'Active',
            'status.stoppedShort': 'Stopped',
            'footer.copyright': 'Money-Dahong Systems. All rights reserved.',
            'footer.version': 'v1.0.0-beta',
            'footer.latency': 'Latency',
            'common.usdt': 'USDT',
            'common.spot': 'SPOT',
            'common.binance': 'BINANCE',
            'common.realtimeUpdates': 'Real-time updates',
            'common.timePlaceholder': '--:--:--',
            'common.saving': 'Saving...',
            'common.saveChanges': 'Save Changes',
            'common.verifying': 'Verifying...',
            'common.testConnection': 'Test Connection',
            'dashboard.title': 'Market Overview',
            'dashboard.subtitle': 'Real-time market data and bot control center.',
            'dashboard.updateRate': 'Update Rate',
            'dashboard.selectedAsset': 'Selected Asset',
            'dashboard.liveFeed': 'Live Feed',
            'dashboard.lastUpdated': 'Last updated',
            'dashboard.botStatus': 'Bot Status',
            'dashboard.botControlHint': 'Control automated trading execution.',
            'dashboard.systemLogs': 'System Logs',
            'dashboard.log.time': 'Time',
            'dashboard.log.level': 'Level',
            'dashboard.log.message': 'Message',
            'log.info': 'INFO',
            'log.warn': 'WARN',
            'dashboard.initLog': 'System initialized. Waiting for stream...',
            'dashboard.statusChanged': 'Bot status changed to {status}',
            'dashboard.errorMessage': 'Error: {message}',
            'trading.title': 'Trading',
            'trading.assetSelection': 'Asset Selection',
            'trading.tradingPair': 'Trading Pair',
            'trading.needMoreSymbols': 'Need more symbols?',
            'trading.configureInSettings': 'Configure in Settings →',
            'trading.liveMarketData': 'Live Market Data',
            'trading.activeSymbol': 'Active Symbol',
            'trading.lastPrice': 'Last Price',
            'trading.moreCharts': 'More charts and indicators coming soon in v1.1',
            'trading.symbolUpdated': 'Active symbol updated to {symbol}',
            'settings.title': 'System Configuration',
            'settings.subtitle': 'Manage API connections and trading parameters.',
            'settings.environment': 'Environment',
            'settings.environmentDesc': 'Configure the execution mode and trading permissions.',
            'settings.sandboxMode': 'Sandbox Mode',
            'settings.testnet': 'Testnet',
            'settings.sandboxDesc': 'Use Binance Testnet for paper trading without real funds.',
            'settings.liveTrading': 'Live Trading',
            'settings.riskOn': 'Risk On',
            'settings.liveTradingDesc': 'Allow the bot to execute real orders on the exchange.',
            'settings.apiCredentials': 'API Credentials',
            'settings.apiDesc': 'Securely store your exchange keys. Keys are never exposed to the client side after saving.',
            'settings.apiCredentialsLive': 'Live Credentials',
            'settings.apiCredentialsSandbox': 'Sandbox Credentials',
            'settings.apiLiveDesc': 'Use your real Binance account keys for live trading.',
            'settings.apiSandboxDesc': 'Use Spot Testnet keys for sandbox mode.',
            'settings.apiKeyLabelLive': 'Binance API Key (Live)',
            'settings.apiSecretLabelLive': 'Binance Secret (Live)',
            'settings.apiKeyLabelSandbox': 'Binance API Key (Sandbox)',
            'settings.apiSecretLabelSandbox': 'Binance Secret (Sandbox)',
            'settings.apiKeyPlaceholderLive': 'Enter your Live API Key',
            'settings.apiSecretPlaceholderLive': 'Enter your Live Secret Key',
            'settings.apiKeyPlaceholderSandbox': 'Enter your Sandbox API Key',
            'settings.apiSecretPlaceholderSandbox': 'Enter your Sandbox Secret Key',
            'settings.apiStatusTitle': 'API Status',
            'settings.apiStatusLive': 'Live',
            'settings.apiStatusSandbox': 'Sandbox',
            'settings.apiStatusConfigured': 'Configured',
            'settings.apiStatusMissing': 'Missing',
            'settings.apiKeyLabel': 'Binance API Key',
            'settings.apiKeyConfigured': 'Key Configured',
            'settings.apiKeyPlaceholder': 'Enter your API Key',
            'settings.apiSecretLabel': 'Binance Secret',
            'settings.apiSecretConfigured': 'Secret Configured',
            'settings.apiSecretPlaceholder': 'Enter your Secret Key',
            'settings.tradingParameters': 'Trading Parameters',
            'settings.tradingParamsDesc': 'Define the operational limits and targets.',
            'settings.allowedSymbolsLabel': 'Allowed Symbols',
            'settings.allowedSymbolsPlaceholder': 'BTC/USDT, ETH/USDT',
            'settings.allowedSymbolsHelp': 'Comma separated list of pairs the bot is allowed to trade.',
            'settings.pollIntervalLabel': 'Poll Interval (seconds)',
            'settings.configurationSaved': 'Configuration saved successfully',
            'settings.connectionVerified': 'Connection verified successfully',
            'settings.version': 'v1.0.0',
        },
        'zh-CN': {
            'app.name': 'Money-Dahong',
            'nav.dashboard': '总览',
            'nav.trading': '交易',
            'nav.settings': '设置',
            'language.zh': '中文',
            'language.en': 'EN',
            'status.systemActive': '系统运行中',
            'status.systemStopped': '系统已停止',
            'status.running': '运行中',
            'status.stopped': '已停止',
            'status.active': '已启动',
            'status.stoppedShort': '已停止',
            'footer.copyright': 'Money-Dahong 系统。保留所有权利。',
            'footer.version': 'v1.0.0-beta',
            'footer.latency': '延迟',
            'common.usdt': 'USDT',
            'common.spot': '现货',
            'common.binance': '币安',
            'common.realtimeUpdates': '实时更新',
            'common.timePlaceholder': '--:--:--',
            'common.saving': '保存中...',
            'common.saveChanges': '保存更改',
            'common.verifying': '验证中...',
            'common.testConnection': '测试连接',
            'dashboard.title': '行情总览',
            'dashboard.subtitle': '实时行情数据与机器人控制中心。',
            'dashboard.updateRate': '刷新频率',
            'dashboard.selectedAsset': '当前交易对',
            'dashboard.liveFeed': '实时流',
            'dashboard.lastUpdated': '最后更新',
            'dashboard.botStatus': '机器人状态',
            'dashboard.botControlHint': '控制自动交易执行。',
            'dashboard.systemLogs': '系统日志',
            'dashboard.log.time': '时间',
            'dashboard.log.level': '级别',
            'dashboard.log.message': '内容',
            'log.info': '信息',
            'log.warn': '警告',
            'dashboard.initLog': '系统已初始化，等待数据流...',
            'dashboard.statusChanged': '机器人状态已切换为 {status}',
            'dashboard.errorMessage': '错误：{message}',
            'trading.title': '交易',
            'trading.assetSelection': '交易对选择',
            'trading.tradingPair': '交易对',
            'trading.needMoreSymbols': '需要更多交易对？',
            'trading.configureInSettings': '前往设置配置 →',
            'trading.liveMarketData': '实时行情',
            'trading.activeSymbol': '当前交易对',
            'trading.lastPrice': '最新价格',
            'trading.moreCharts': '更多图表与指标将在 v1.1 上线',
            'trading.symbolUpdated': '交易对已切换为 {symbol}',
            'settings.title': '系统配置',
            'settings.subtitle': '管理 API 连接与交易参数。',
            'settings.environment': '运行环境',
            'settings.environmentDesc': '配置运行模式与交易权限。',
            'settings.sandboxMode': '沙盒模式',
            'settings.testnet': '测试网',
            'settings.sandboxDesc': '使用 Binance 测试网进行模拟交易。',
            'settings.liveTrading': '真实交易',
            'settings.riskOn': '风险开启',
            'settings.liveTradingDesc': '允许机器人在交易所执行真实订单。',
            'settings.apiCredentials': 'API 凭证',
            'settings.apiDesc': '安全保存交易所密钥，保存后不会在客户端显示。',
            'settings.apiCredentialsLive': '实盘凭证',
            'settings.apiCredentialsSandbox': '沙盒凭证',
            'settings.apiLiveDesc': '使用实盘 Binance 账户密钥进行真实交易。',
            'settings.apiSandboxDesc': '沙盒模式下使用 Spot Testnet 密钥。',
            'settings.apiKeyLabelLive': 'Binance API Key（实盘）',
            'settings.apiSecretLabelLive': 'Binance Secret（实盘）',
            'settings.apiKeyLabelSandbox': 'Binance API Key（沙盒）',
            'settings.apiSecretLabelSandbox': 'Binance Secret（沙盒）',
            'settings.apiKeyPlaceholderLive': '请输入实盘 API Key',
            'settings.apiSecretPlaceholderLive': '请输入实盘 Secret Key',
            'settings.apiKeyPlaceholderSandbox': '请输入沙盒 API Key',
            'settings.apiSecretPlaceholderSandbox': '请输入沙盒 Secret Key',
            'settings.apiStatusTitle': 'API 状态',
            'settings.apiStatusLive': '实盘',
            'settings.apiStatusSandbox': '沙盒',
            'settings.apiStatusConfigured': '已配置',
            'settings.apiStatusMissing': '未配置',
            'settings.apiKeyLabel': 'Binance API Key',
            'settings.apiKeyConfigured': '已配置',
            'settings.apiKeyPlaceholder': '请输入 API Key',
            'settings.apiSecretLabel': 'Binance Secret',
            'settings.apiSecretConfigured': '已配置',
            'settings.apiSecretPlaceholder': '请输入 Secret Key',
            'settings.tradingParameters': '交易参数',
            'settings.tradingParamsDesc': '定义运行限制与目标。',
            'settings.allowedSymbolsLabel': '允许交易对',
            'settings.allowedSymbolsPlaceholder': 'BTC/USDT, ETH/USDT',
            'settings.allowedSymbolsHelp': '逗号分隔的允许交易对列表。',
            'settings.pollIntervalLabel': '轮询间隔（秒）',
            'settings.configurationSaved': '配置保存成功',
            'settings.connectionVerified': '连接验证成功',
            'settings.version': 'v1.0.0',
        }
    }

    const baseMixin = {
        data() {
            return {
                status: 'Stopped',
                last_price: null,
                lang: getInitialLang(),
                pageTitleKey: '',
                loading: false,
                error: '',
                message: ''
            }
        },
        methods: {
            t(key, params = {}) {
                const fallback = translations.en?.[key] || key
                const template = translations[this.lang]?.[key] || fallback
                return template.replace(/\{(\w+)\}/g, (match, prop) => {
                    if (params[prop] === undefined || params[prop] === null) return ''
                    return params[prop]
                })
            },
            setLanguage(lang) {
                this.lang = lang
            },
            setPageTitle(key) {
                this.pageTitleKey = key
                this.updateTitle()
            },
            updateTitle() {
                if (!this.pageTitleKey) {
                    document.title = appName
                    return
                }
                document.title = `${appName} - ${this.t(this.pageTitleKey)}`
            },
            statusLabel() {
                return this.status === 'Active' ? this.t('status.active') : this.t('status.stoppedShort')
            },
            async fetchStatus() {
                try {
                    const res = await fetch('/api/status')
                    if (!res.ok) throw new Error('Status fetch failed')
                    const data = await res.json()
                    this.status = data.status || 'Stopped'
                    this.last_price = data.last_price
                    if (this.onStatusUpdate) this.onStatusUpdate(data)
                } catch (err) {
                    console.error(err)
                }
            }
        },
        watch: {
            lang() {
                try {
                    localStorage.setItem('lang', this.lang)
                } catch (err) {
                    console.error(err)
                }
                this.updateTitle()
            }
        },
        mounted() {
            this.fetchStatus()
            this.statusTimer = setInterval(this.fetchStatus, 2000)
            this.updateTitle()
        },
        beforeUnmount() {
            if (this.statusTimer) clearInterval(this.statusTimer)
        }
    }
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
